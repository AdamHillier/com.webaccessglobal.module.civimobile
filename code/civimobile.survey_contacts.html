<?php require_once 'civimobile.header.php'; ?>

<div data-role="page" id="cm-survey-contacts">
  <div data-role="header"> 
    <h3>Survey Respondants</h3>
    <a href="#" data-rel="back" class="ui-btn-left" data-icon="arrow-l" data-transition="slideup">Back</a> 
  </div> 

  <div data-role="content" id="survey-respondant-content">
    <div class="ui-listview-filter ui-bar-c">
      <input type="search" name="sc_name" id="sc_name" value=""/>
    </div>
    <ul id="survey-contacts" data-role="listview" data-inset="false" data-filter="false"></ul>
  </div>

  <script>
    function surveyRespondantSearch(q) {
      var surveyId = <?php echo $_GET['sid']; ?>;
      var resId = <?php echo $_GET['resid']; ?>;

      if ( isNaN(surveyId) || isNaN(resId) ) {
        return;
      }

      $.mobile.showPageLoadingMsg( 'Searching' );
      $().crmAPI ('SurveyRespondant','get',
      {'version' :'3', 'survey_id': surveyId,
        'voter_name': {'LIKE': q + '%'} },
      { 
        ajaxURL: crmajaxURL,
        success:function (data){
          if (data.count == 0) {
            cmd = null;
          }
          else {
            cmd = "refresh";
            $('#survey-contacts').show();
            $('#survey-contacts').empty();
          }
          $.each(data.values, function(key, value) {
            $('#survey-contacts').append('<li role="option" tabindex="-1" data-ajax="false" data-theme="c" id="survey-res-'+value.id+'" ><a href="/civicrm/mobile/survey/interview?sid='+ surveyId +'&resid='+ resId +'&aid='+ value.id +'&cid='+value.voter_id+'" data-transition="slideup">'+value.voter_name+'</a></li>');
          });
          $.mobile.hidePageLoadingMsg( );
          $('#survey-contacts').listview(cmd); 
        }
      });
    }
  </script>
</div>
<!-- end of page -->
<?php require_once 'civimobile.footer.php'; ?> 
